<div class="container">

  <div class="row mt-3 mb-3">
      <div class="col-sm-12" *ngIf="CertType == '1'">
          <p class="instructions">
              Please provide details for your new application.
          </p>
          <p class="instructions">
              Add your degree information below. For current education requirements,
              visit the <a [href]="'https://www.bacb.com/bcba/'" ExternalUrl target="_blank" style="color: #005072;">BCBA page</a>.
              and download the latest eligibility requirements.
          </p>
      </div>
      <div class="col-sm-12" *ngIf="CertType == '2'">
          <p class="instructions">
              Please provide details for your new application.
          </p>
          <p class="instructions">
              Add your degree information below. For current education requirements,
              visit the <a [href]="'https://www.bacb.com/bcaba/'" ExternalUrl target="_blank" style="color: #005072;">BCaBA page</a>
              and download the latest eligibility requirements.
          </p>
      </div>
  </div>

  <!-- my degrees-->
  <div class="row mt-4">
    <div class="col-sm-12">
      <div class="panel panel-default bacb-panel-bg">
        <legend class="panel-heading bacb-panel-header">
          <div class="small-container align-middle">
            <div class="bacb-panel-header-text">Education History</div>
            <div class="fill"></div>
            <div><button mat-raised-button color = "primary" (click)="OnClickNew()">
                <mat-icon inline="true">add_box</mat-icon>&nbsp; Add Degree
              </button></div>
          </div>
        </legend>

        <div class="panel-body">
          <table mat-table #EducationTable [dataSource]="DegreeArr$ | async" class="table table-striped">
            <tr mat-header-row *matHeaderRowDef="DisplayedTableColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: DisplayedTableColumns;"></tr>
            <ng-container matColumnDef="Level">
              <th mat-header-cell *matHeaderCellDef>Degree Level</th>
              <td mat-cell *matCellDef="let Degree">{{ Degree.Type?.Value }}</td>
            </ng-container>
            <ng-container matColumnDef="Major">
              <th mat-header-cell *matHeaderCellDef>Major</th>
              <td mat-cell *matCellDef="let Degree">{{ Degree.Major }}</td>
            </ng-container>
            <ng-container matColumnDef="DateConferred">
              <th mat-header-cell *matHeaderCellDef>Date Conferred</th>
              <td mat-cell *matCellDef="let Degree">{{ Degree.DateConferred | date:'shortDate' }}</td>
            </ng-container>
            <ng-container matColumnDef="Institution">
              <th mat-header-cell *matHeaderCellDef>Institution</th>
              <td mat-cell *matCellDef="let Degree">{{ Degree.Institution?.Name }}</td>
            </ng-container>
            <ng-container matColumnDef="Actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let Degree">
                <button type="button" class="btn btn-link border" (click)="OnClickEdit(Degree)">
                  <mat-icon class="bacb-icon">edit</mat-icon>
                </button>
                <button type="button" class="btn btn-link border" (click)="OnClickDelete(Degree)">
                  <mat-icon class="bacb-icon">delete</mat-icon>
                </button>
              </td>
            </ng-container>
          </table>
        </div> <!-- end inner panel body -->
      </div> <!-- end outer panel body -->
    </div>
  </div>

  <!--  Add Degree / Edit Degree Form -->
  <!-- This tuple is [0]: current action; [1]: show lower panel or not -->
  <div class="row mt-4" *ngIf="(actionAndVisible | async)[1] == true">
    <div class="col-sm-12">
      <div class="panel panel-default bacb-panel-bg">
        <legend class="panel-heading bacb-panel-header" *ngIf=" (actionAndVisible | async)[1] == true">{{ (actionAndVisible | async)[0] }}</legend>

        <div class="panel-body">
          <form [formGroup]="EducationForm" (ngSubmit)="OnSubmit()" class="mt-2 mb-2">
            <!-- Row 1 -->
            <div class="row mb-3 pl-3 pr-3">
              <div class="col-sm-12">
                <mat-form-field *ngIf="1 == 0">
                  <mat-label>Degree ID</mat-label>
                  <input matInput Type="Text" formControlName="Id">
                </mat-form-field>
              </div>
            </div>
            <div class="row mb-3 pl-3 pr-3">
              <div class="col-sm-6">
                <mat-form-field class="width-100">
                  <mat-label>Degree Level</mat-label>

                  <mat-select formControlName="Type" [compareWith]="CompareListObj">
                    <mat-option *ngFor="let Type of DegreeTypesLOArr$" [value]="Type"> {{ Type.Value }} </mat-option>
                  </mat-select>
                  <mat-error *ngIf="!EducationForm.controls['Type'].valid && EducationForm.controls['Type'].touched">
                    Degree Type is required.
                  </mat-error>
                </mat-form-field>
              </div>
              <div class="col-sm-6">
                <mat-form-field class="width-100">
                  <mat-label>Major</mat-label>
                  <input matInput Type="Text" formControlName="Major">
                  <mat-error *ngIf="!EducationForm.controls['Major'].valid && EducationForm.controls['Major'].touched">
                    Degree Major is required.
                  </mat-error>
                </mat-form-field>
              </div>
            </div>
            <div *ngIf="EducationForm.controls['Type'].value?.Id == '93e776d6-15ee-ea11-a817-000d3a5a1cf8'">
              <app-large-file-upload
              [AllowDeleteButton]="true"
              [LegendText]="'Please Upload High School Diploma'"
              [FileTypes]="[HighSchoolDiplomaDocumentType]"
              ></app-large-file-upload>
            </div>
            <!-- Row 2 -->
            <div class="row mb-3 pl-3 pr-3">
              <div *ngIf=" EducationForm.controls['AddInstitution'] && !EducationForm.controls['AddInstitution'].value"
                class="col-sm-6">
                <mat-form-field class="width-100">
                  <mat-label>Institution</mat-label>
                  <input type="text"
                  matInput
                  placeholder="Select an Institution"
                  formControlName="InstitutionFC"
                  [matAutocomplete]="auto"
                  >
                  <mat-error
                    *ngIf="!EducationForm.controls['InstitutionFC'].valid && EducationForm.controls['InstitutionFC'].touched">
                    Institution is required.
                  </mat-error>
                </mat-form-field>
                <mat-autocomplete #auto="matAutocomplete" [displayWith] = "displayInstitution">
                  <mat-option *ngIf="IsLoading">
                    <mat-spinner diameter="50"></mat-spinner>
                  </mat-option>
                  <ng-container *ngIf="true">
                    <mat-option *ngFor="let inst of autoInst | async" [value]="inst">
                      {{ inst.Name }}
                    </mat-option>
                  </ng-container>
                </mat-autocomplete>
              </div>
              <div class="col-sm-6">
                <mat-form-field>
                  <mat-label>Date Conferred</mat-label>
                  <input matInput [matDatepicker]="DateConferredPicker" formControlName="DateConferred">
                  <mat-datepicker-toggle matSuffix [for]="DateConferredPicker"></mat-datepicker-toggle>
                  <mat-datepicker #DateConferredPicker></mat-datepicker>
                </mat-form-field>
              </div>
            </div>
            <!-- Row 3 -->
            <div class="row mt-4 pl-3 pr-3">
              <div class="col-sm-6">
                <mat-checkbox color="primary" formControlName="AddInstitution">
                  I do not see my institution listed
                </mat-checkbox>
              </div>
              <div class="col-sm-6 d-flex justify-content-end">
                <button mat-raised-button color = "primary" class="btn-primary mr-4" (click)="OnClickCancel()">Cancel </button>
                <button mat-raised-button color = "primary"
                  class="btn-primary"
                  type="submit"
                  [disabled] = "!EducationForm.valid || EducationForm.controls['AddInstitution'].value == true || (EducationForm.controls['Type'].value?.Id == '93e776d6-15ee-ea11-a817-000d3a5a1cf8' && (FileCheck$ | async).Response == 'F') ">Save </button>
              </div>
              <div class="col-sm-2"><br></div>
            </div>
          </form>
        </div> <!-- end inner panel body -->
      </div>
    </div>
    <!--  Add New Institution Form -->
    <div class="col-sm-12 mt-4"
      *ngIf="EducationForm.controls['AddInstitution'] && EducationForm.controls['AddInstitution'].value">
      <div class="">
        <div class="panel panel-default bacb-panel-bg">
          <legend class="panel-heading bacb-panel-header">New Institution</legend>
          <div class="panel-body">
            <form [formGroup]="InstitutionForm" (ngSubmit)="OnSubmitInstitution()" class="mt-2 mb-2">
               <!-- Row 1 -->
              <div class="row mb-3 pl-3 pr-3">
                <div class="col-sm-6">
                  <mat-form-field class="width-100">
                    <mat-label>Name</mat-label>
                    <input matInput Type="Text" formControlName="Name">
                    <mat-error
                      *ngIf="!InstitutionForm.controls['Name'].valid && InstitutionForm.controls['Name'].touched">
                      Institution name is required.
                    </mat-error>
                  </mat-form-field>
                </div>
                <div class="col-sm-6">
                  <mat-form-field class="width-100">
                    <mat-label>Website</mat-label>
                    <input matInput Type="Text" formControlName="Website">
                  </mat-form-field>
                </div>
              </div>
              <!-- #Row 2 -->
              <div class="row mb-3 pl-3 pr-3">
                <div class="col-sm-12">
                  <mat-form-field class="width-100">
                    <mat-label>Address1</mat-label>
                    <input matInput Type="Text" formControlName="Address1">
                  </mat-form-field>
                </div>
              </div>
              <!-- #Row 3 -->
              <div class="row mb-3 pl-3 pr-3">
                <div class="col-sm-12">
                  <mat-form-field class="width-100">
                    <mat-label>Address2</mat-label>
                    <input matInput Type="Text" formControlName="Address2">
                  </mat-form-field>
                </div>
              </div>
              <!-- #Row 4 -->
              <div class="row mb-3 pl-3 pr-3">
                <div class="col-sm-3">
                  <mat-form-field>
                    <mat-label>City</mat-label>
                    <input type="text" matInput formControlName="City">
                  </mat-form-field>
                </div>

                <div class="col-sm-3" *ngIf="SelectedCountry == null || SelectedCountry.DialCode == '1'">
                  <mat-form-field>
                    <mat-label>State/Province</mat-label>
                    <mat-select formControlName="State">
                      <mat-option *ngFor="let InstShippingState of (StateList$)[0].States"
                        [value]="InstShippingState"> {{InstShippingState.Abbrev}} -
                        {{InstShippingState.Name}} </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="col-sm-3">
                  <mat-form-field>
                    <mat-label>Country</mat-label>
                    <mat-select [compareWith]="CompareCountry" formControlName="Country" [(value)]="DefaultCountry">
                      <mat-option *ngFor="let InstCountry of (CountryList$)" [value]="InstCountry"
                        (selectionChange)="OnSelectCountry(InstCountry)"> {{InstCountry.Name}} </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="col-sm-3">
                  <mat-form-field>
                    <mat-label>Postal Code</mat-label>
                    <input matInput type="text" formControlName="PostalCode">
                  </mat-form-field>
                </div>
              </div>
              <!-- #Row 5 -->
              <div class="row mt-4 pl-3 pr-3">
                <div class="col-sm-6">

                </div>
                <div class="col-sm-6 d-flex justify-content-end">
                  <button mat-raised-button color = "primary" class="btn-primary" (click)="OnSubmitInstitution()">Save</button>
                </div>
                <div class="col-sm-2"><br></div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
